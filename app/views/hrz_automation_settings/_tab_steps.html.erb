<%# ------------------------------------------------------------------------------------------- %>
<%#  Redmine utility/library plugin. Provides common functions to other plugins + REST API.     %>
<%#  Copyright (C) 2026 Franz Apeltauer                                                         %>
<%#                                                                                             %>
<%#  This program is free software: you can redistribute it and/or modify it under the terms    %>
<%#  of the GNU Affero General Public License as published by the Free Software Foundation,     %>
<%#  either version 3 of the License, or (at your option) any later version.                    %>
<%#                                                                                             %>
<%#  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;  %>
<%#  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  %>
<%#  See the GNU Affero General Public License for more details.                                %>
<%#                                                                                             %>
<%#  You should have received a copy of the GNU Affero General Public License                   %>
<%#  along with this program.  If not, see <https://www.gnu.org/licenses/>.                     %>
<%# -------------------------------------------------------------------------------------eohdr- %>
<h3><%= l(:label_steps) %></h3>

<% if @steps.any? %>
<table class="list">
  <thead>
    <tr>
      <th><%= l(:field_step_id) %></th>
      <th><%= l(:field_step_title) %></th>
      <th><%= l(:field_todo) %></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @steps.each do |step| %>
    <tr>
      <td><%= step.j_step_id %></td>
      <td><%= step.b_title %></td>
      <td><%= step.todo&.b_name %></td>
      <td class="buttons">
        <%= link_to l(:button_edit), 'javascript:void(0)', 
            onclick: "showEditForm('step', #{step.j_step_id})", 
            class: 'icon icon-edit' %>
        <%= link_to l(:button_delete), 
            { action: 'destroy_step', id: step.j_step_id }, 
            method: :delete, 
            data: { confirm: l(:text_are_you_sure) }, 
            class: 'icon icon-del' %>
      </td>
    </tr>
    <tr id="edit_step_<%= step.j_step_id %>" style="display:none;">
      <td colspan="4">
        <%= render partial: 'step_form', locals: { step: step, todos: @todos, url: { action: 'update_step', id: step.j_step_id }, method: :patch } %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>
<% else %>
<p class="nodata"><%= l(:label_no_data) %></p>
<% end %>

<h3><%= l(:label_new_step) %></h3>
<%= render partial: 'step_form', locals: { step: @step, todos: @todos, url: { action: 'create_step' }, method: :post } %>

<script>
function showEditForm(type, id) {
  document.getElementById('edit_' + type + '_' + id).style.display = '';
}
function hideEditForm(type, id) {
  document.getElementById('edit_' + type + '_' + id).style.display = 'none';
}
</script>
