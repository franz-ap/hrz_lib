<%# ------------------------------------------------------------------------------------------- %>
<%#  Redmine utility/library plugin. Provides common functions to other plugins + REST API.     %>
<%#  Copyright (C) 2026 Franz Apeltauer                                                         %>
<%#                                                                                             %>
<%#  This program is free software: you can redistribute it and/or modify it under the terms    %>
<%#  of the GNU Affero General Public License as published by the Free Software Foundation,     %>
<%#  either version 3 of the License, or (at your option) any later version.                    %>
<%#                                                                                             %>
<%#  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;  %>
<%#  without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  %>
<%#  See the GNU Affero General Public License for more details.                                %>
<%#                                                                                             %>
<%#  You should have received a copy of the GNU Affero General Public License                   %>
<%#  along with this program.  If not, see <https://www.gnu.org/licenses/>.                     %>
<%# -------------------------------------------------------------------------------------eohdr- %>
<%= form_for action, url: url, method: method, html: { class: 'tabular' } do |f| %>
  <div class="box">
    <p>
      <%= f.label :b_title, l(:field_action_title) %>
      <%= f.text_field :b_title, size: 80, required: true, readonly: (method == :patch) %>
    </p>
    <p>
      <%= f.label :b_comment, l(:field_comment) %>
      <%= f.text_area :b_comment, rows: 3, cols: 80 %>
      <em class="info"><%= l(:help_comment_users) %></em>
    </p>
    <p>
      <%= f.label :jq_on_new_ticket, l(:field_on_new_ticket) %>
      <%= f.check_box :jq_on_new_ticket %>
      <em class="info"><%= l(:help_on_new_ticket) %></em>
    </p>
    <p>
      <%= f.label :jq_on_ticket_update, l(:field_on_ticket_update) %>
      <%= f.check_box :jq_on_ticket_update %>
      <em class="info"><%= l(:help_on_ticket_update) %></em>
    </p>
    
    <fieldset class="box"><legend><%= l(:label_conditions) %></legend>
      <em class="info"><%= l(:help_conditions_all) %></em>
      <% (1..5).each do |i| %>
        <p>
          <%= f.label "j_cond#{i}_id".to_sym, "#{l(:field_condition)} #{i}" %>
          <%= f.select "j_cond#{i}_id".to_sym, 
              options_for_select(conditions.map { |c| [c.b_cond_question, c.j_condition_id] }, 
              action.send("j_cond#{i}_id")), 
              { include_blank: true } %>
        </p>
      <% end %>
    </fieldset>
    
    <fieldset class="box"><legend><%= l(:label_steps) %></legend>
      <% (1..5).each do |i| %>
        <p>
          <%= f.label "j_step#{i}_id".to_sym, "#{l(:field_step)} #{i}" %>
          <%= f.select "j_step#{i}_id".to_sym, 
              options_for_select(steps.map { |s| [s.b_title, s.j_step_id] }, 
              action.send("j_step#{i}_id")), 
              { include_blank: true } %>
        </p>
      <% end %>
    </fieldset>
    
    <p>
      <%= f.submit method == :post ? l(:button_create) : l(:button_save) %>
      <% if method == :patch %>
        <%= link_to l(:button_cancel), 'javascript:void(0)', onclick: "hideEditForm('action', '#{j action.b_title}')" %>
      <% end %>
    </p>
  </div>
<% end %>
